<div class="max-w-4xl mx-auto">
  <div class="mb-6">
    <a href="/practices" class="text-slate-400 hover:text-white text-sm">‚Üê Practices</a>
  </div>
  <h1 class="text-2xl font-semibold text-white mb-2"><%= practice.name || 'Practice' %></h1>
  <p class="text-slate-400 text-sm mb-6">Contact details and lead status. Update status or add a note below.</p>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <div class="bg-slate-800/60 border border-slate-700 rounded-xl p-6">
      <h2 class="text-lg font-semibold text-white mb-4">Contact</h2>
      <dl class="space-y-2 text-sm">
        <% if (practice.website) { %><dt class="text-slate-500">Website</dt><dd><a href="<%= practice.website %>" target="_blank" rel="noopener" class="text-cyan-400 hover:underline"><%= practice.website %></a></dd><% } %>
        <% if (practice.email) { %><dt class="text-slate-500">Email</dt><dd><a href="mailto:<%= practice.email %>" class="text-cyan-400 hover:underline"><%= practice.email %></a></dd><% } %>
        <% if (practice.contact) { %><dt class="text-slate-500">Contact</dt><dd class="text-slate-200"><%= practice.contact %></dd><% } %>
        <% if (practice.address) { %><dt class="text-slate-500">Address</dt><dd class="text-slate-200"><%= practice.address %></dd><% } %>
        <% if (!practice.website && !practice.email && !practice.contact && !practice.address) { %><p class="text-slate-500">No contact info.</p><% } %>
      </dl>
    </div>
    <div class="bg-slate-800/60 border border-slate-700 rounded-xl p-6">
      <h2 class="text-lg font-semibold text-white mb-4">Lead</h2>
      <form id="lead-form" class="space-y-4">
        <div>
          <label class="block text-slate-400 text-sm mb-1">Status</label>
          <select name="status" class="w-full px-3 py-2 rounded-lg bg-slate-700 border border-slate-600 text-white">
            <% (lead_statuses || []).forEach(function(s) { %>
            <option value="<%= s %>" <%= lead && lead.status === s ? 'selected' : '' %>><%= s %></option>
            <% }); %>
          </select>
        </div>
        <div>
          <label class="block text-slate-400 text-sm mb-1">Notes</label>
          <textarea name="notes" rows="3" class="w-full px-3 py-2 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-slate-500"><%= lead && lead.notes ? lead.notes : '' %></textarea>
        </div>
        <button type="submit" class="px-4 py-2 rounded-lg bg-cyan-600 hover:bg-cyan-500 text-white font-medium">Save</button>
      </form>
    </div>
  </div>

  <% if (practice.description) { %>
  <div class="bg-slate-800/60 border border-slate-700 rounded-xl p-6 mb-8">
    <h2 class="text-lg font-semibold text-white mb-2">Description</h2>
    <p class="text-slate-300 text-sm whitespace-pre-wrap"><%= practice.description %></p>
  </div>
  <% } %>

  <div class="bg-slate-800/60 border border-slate-700 rounded-xl p-6">
    <h2 class="text-lg font-semibold text-white mb-4">Activity</h2>
    <form id="activity-form" class="flex gap-3 mb-6">
      <input type="text" name="title" placeholder="Title" class="flex-1 px-3 py-2 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-slate-500" />
      <input type="text" name="body" placeholder="Note" class="flex-1 px-3 py-2 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-slate-500" />
      <button type="submit" class="px-4 py-2 rounded-lg bg-slate-600 hover:bg-slate-500 text-white font-medium">Add</button>
    </form>
    <ul class="space-y-2">
      <% (activities || []).forEach(function(a) { %>
      <li class="flex gap-3 text-sm py-2 border-t border-slate-700 first:border-t-0">
        <span class="text-slate-500 shrink-0"><%= new Date(a.created_at).toLocaleString() %></span>
        <span class="text-cyan-400 capitalize"><%= a.kind %></span>
        <% if (a.title) { %><span class="text-white font-medium"><%= a.title %></span><% } %>
        <% if (a.body) { %><span class="text-slate-300"><%= a.body %></span><% } %>
      </li>
      <% }); %>
      <% if (!activities || activities.length === 0) { %>
      <li class="text-slate-500 text-sm py-2">No activity yet.</li>
      <% } %>
    </ul>
  </div>
</div>

<script>
(function() {
  var leadId = <%= lead ? lead.id : 'null' %>;
  if (!leadId) return;

  document.getElementById('lead-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var form = e.target;
    var status = form.querySelector('[name=status]').value;
    var notes = form.querySelector('[name=notes]').value;
    fetch('/api/leads/' + leadId, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ status: status, notes: notes })
    })
    .then(function(r) { return r.json(); })
    .then(function() { window.location.reload(); })
    .catch(function(err) { console.error(err); alert('Failed to save'); });
  });

  document.getElementById('activity-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var form = e.target;
    var title = form.querySelector('[name=title]').value.trim();
    var body = form.querySelector('[name=body]').value.trim();
    if (!title && !body) return;
    fetch('/api/leads/' + leadId + '/activity', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ kind: 'note', title: title, body: body })
    })
    .then(function(r) { return r.json(); })
    .then(function() { window.location.reload(); })
    .catch(function(err) { console.error(err); alert('Failed to add activity'); });
  });
})();
</script>
